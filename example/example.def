-- other files can be included for increased modularity
-- import "module.def";

class Versioned {
    version Int64;
}
entity Person : Versioned {
    firstName Text check nonEmpty;
    lastName Text check nonEmpty;
    timezone Text check validTimezone;
    email Text check validEmail;
    birthDate Date;

    -- service definitions start here
    get { 
        -- GET service does not require authentication
        public;

        -- ExtJS compatible filtering and sorting parameters
        -- can be generated by including the following keyword
        default-filter-sort; 
    }
    post {
        public;
    }
    delete {
        public;
    }
    put {
        public;
    }
    validate {
        public;
    }
}

entity Note : Versioned {
    owner   Person;
    body    Text;
    created DateTime;
    get { 
        public;
    }
    post {
        public;
    }
    delete {
        public;
    }
    put {
        public;
    }
    validate {
        public;
    }
}

entity ChangeRecord {
    field    Text;
    oldValue Text;
    newValue Text;
    time     DateTime;
    version  Int64;

    -- a polymorphic relation which will be expanded to a number of fields
    -- pointing a each possible entity that is an instance of Versioned
    'entity' Maybe Versioned;
}
